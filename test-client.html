<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VespaTrace API Test Client</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .section { background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 8px; }
        .result { background: #e8f5e8; padding: 10px; margin: 10px 0; border-radius: 5px; border-left: 4px solid #4CAF50; }
        .error { background: #ffe8e8; padding: 10px; margin: 10px 0; border-radius: 5px; border-left: 4px solid #f44336; }
        button { background: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #45a049; }
        input, textarea { width: 100%; padding: 8px; margin: 5px 0; box-sizing: border-box; }
        pre { background: #f0f0f0; padding: 10px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üêù VespaTrace API Test Client</h1>
    
    <div class="section">
        <h2>API Health Check</h2>
        <button onclick="testHealth()">Test Health Endpoint</button>
        <div id="healthResult"></div>
    </div>
    
    <div class="section">
        <h2>Hornet Identification Test</h2>
        <p>This simulates uploading an image for hornet species identification:</p>
        <button onclick="testHornetIdentification()">Test Hornet ID (Simulated)</button>
        <div id="hornetResult"></div>
    </div>
    
    <div class="section">
        <h2>Report Hornet Sighting</h2>
        <p>Latitude: <input type="number" id="sightingLat" value="52.0705" step="0.0001" placeholder="52.0705"></p>
        <p>Longitude: <input type="number" id="sightingLng" value="4.3007" step="0.0001" placeholder="4.3007"></p>
        <p>Description: <input type="text" id="sightingDesc" placeholder="Large hornet near beehive" value="Large hornet spotted near garden beehive"></p>
        <button onclick="testReportSighting()">Report Sighting</button>
        <div id="sightingResult"></div>
    </div>
    
    <div class="section">
        <h2>Find Nearby Nests</h2>
        <p>Search Latitude: <input type="number" id="searchLat" value="52.0705" step="0.0001"></p>
        <p>Search Longitude: <input type="number" id="searchLng" value="4.3007" step="0.0001"></p>
        <p>Radius (meters): <input type="number" id="searchRadius" value="5000"></p>
        <button onclick="testNearbyNests()">Find Nearby Nests</button>
        <div id="nearbyResult"></div>
    </div>
    
    <div class="section">
        <h2>Register Apiary</h2>
        <p>Name: <input type="text" id="apiaryName" value="Test Bee Farm" placeholder="My Bee Farm"></p>
        <p>Latitude: <input type="number" id="apiaryLat" value="52.0705" step="0.0001"></p>
        <p>Longitude: <input type="number" id="apiaryLng" value="4.3007" step="0.0001"></p>
        <p>Number of Hives: <input type="number" id="apiaryHives" value="5"></p>
        <p>Email: <input type="email" id="apiaryEmail" value="beekeeper@example.com"></p>
        <button onclick="testRegisterApiary()">Register Apiary</button>
        <div id="apiaryResult"></div>
    </div>

    <script>
        const apiBase = 'http://localhost:5028/api';
        
        async function apiCall(endpoint, method = 'GET', data = null) {
            try {
                const options = {
                    method,
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    }
                };
                
                if (data) {
                    options.body = JSON.stringify(data);
                }
                
                const response = await fetch(apiBase + endpoint, options);
                const result = await response.json();
                
                return {
                    success: response.ok,
                    status: response.status,
                    data: result
                };
            } catch (error) {
                return {
                    success: false,
                    error: error.message
                };
            }
        }
        
        function displayResult(elementId, result) {
            const element = document.getElementById(elementId);
            const resultClass = result.success ? 'result' : 'error';
            
            element.innerHTML = `
                <div class="${resultClass}">
                    <strong>Status:</strong> ${result.success ? 'Success' : 'Error'} ${result.status || ''}<br>
                    <pre>${JSON.stringify(result.data || result.error, null, 2)}</pre>
                </div>
            `;
        }
        
        async function testHealth() {
            const result = await apiCall('/health');
            displayResult('healthResult', result);
        }
        
        async function testHornetIdentification() {
            // Simulate a base64 image (empty for demo)
            const data = {
                imageBase64: "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD//gA7Q1JFQVRPUjogZ2QtanBlZyB2MS4wICh1c2luZyBJSkcgSlBFRyB2ODApLCBxdWFsaXR5ID0gOTAK/9sAQwADAgIDAgIDAwMDBAMDBAUIBQUEBAUKBwcGCAwKDAwLCgsLDQ4SEA0OEQ4LCxAWEBETFBUVFQwPFxgWFBgSFBUU/9sAQwEDBAQFBAUJBQUJFA0LDRQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQU/8AAEQgAAQABAwEiAAIRAQMRAf/EAB8AAAEFAQEBAQEBAAAAAAAAAAABAgMEBQYHCAkKC//EALUQAAIBAwMCBAMFBQQEAAABfQECAwAEEQUSITFBBhNRYQcicRQygZGhCCNCscEVUtHwJDNicoIJChYXGBkaJSYnKCkqNDU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6g4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2drh4uPk5ebn6Onq8fLz9PX29/j5+v/EAB8BAAMBAQEBAQEBAQEAAAAAAAABAgMEBQYHCAkKC//EALURAAIBAgQEAwQHBQQEAAECdwABAgMRBAUhMQYSQVEHYXETIjKBkQgUQqGxwSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD9/KKKKAP/2Q=="
            };
            
            const result = await apiCall('/v1/hornets/identify', 'POST', data);
            displayResult('hornetResult', result);
        }
        
        async function testReportSighting() {
            const data = {
                species: "VespaVelutina", // Asian Giant Hornet
                confidence: 0.85,
                latitude: parseFloat(document.getElementById('sightingLat').value),
                longitude: parseFloat(document.getElementById('sightingLng').value),
                description: document.getElementById('sightingDesc').value,
                riskLevel: "High",
                temperature: 22.5,
                humidity: 65,
                windSpeed: 3.2,
                weatherCondition: "Sunny",
                imageBase64: "data:image/jpeg;base64,mock-image-data"
            };
            
            const result = await apiCall('/v1/nests/report', 'POST', data);
            displayResult('sightingResult', result);
        }
        
        async function testNearbyNests() {
            const lat = parseFloat(document.getElementById('searchLat').value);
            const lng = parseFloat(document.getElementById('searchLng').value);
            const radius = parseInt(document.getElementById('searchRadius').value);
            
            const result = await apiCall(`/v1/nests/nearby?latitude=${lat}&longitude=${lng}&radiusMeters=${radius}`);
            displayResult('nearbyResult', result);
        }
        
        async function testRegisterApiary() {
            const data = {
                name: document.getElementById('apiaryName').value,
                latitude: parseFloat(document.getElementById('apiaryLat').value),
                longitude: parseFloat(document.getElementById('apiaryLng').value),
                numberOfHives: parseInt(document.getElementById('apiaryHives').value),
                contactEmail: document.getElementById('apiaryEmail').value,
                alertsEnabled: true,
                alertRadius: 2000
            };
            
            const result = await apiCall('/v1/apiaries/register', 'POST', data);
            displayResult('apiaryResult', result);
        }
        
        // Test health on page load
        window.onload = function() {
            testHealth();
        };
    </script>
</body>
</html>